import{m as d,a as m}from"./vuex.cc7cb26e.js";import{n,N as M,e as r,U as f}from"./app.bea246d8.js";import{C as j,R as P,T as N}from"./CheckinExport.f628d5e0.js";import{D as R}from"./index.622a70f7.js";import{T as B,a as E,b as O}from"./TaskDetail.ae91f94d.js";import{n as U}from"./index.d4db92a7.js";import{m as _}from"./@micro-zoe.c2e1472d.js";import{l as z}from"./longpress.6c9d7403.js";import{D as F}from"./DialogWrapper.dcc0844e.js";import{l as Y,A as V}from"./details.69037293.js";import{M as K}from"./MicroApps.de9fd2ab.js";import{I as G}from"./ImgUpload.e7c34e8c.js";import{n as H}from"./notification-koro1.99b93615.js";import"./jquery.c17109f7.js";import"./@babel.f9bcab46.js";import"./dayjs.7f99e5ad.js";import"./localforage.6a901908.js";import"./markdown-it.bda97caf.js";import"./mdurl.ce6c1dd8.js";import"./uc.micro.8d343c98.js";import"./entities.48a44fec.js";import"./linkify-it.c5e8196e.js";import"./punycode.js.4b3f125a.js";import"./highlight.js.ab8aeea4.js";import"./markdown-it-link-attributes.e1d5d151.js";import"./@traptitech.897ae552.js";import"./vue.fd9b772e.js";import"./openpgp_hi.15f91b1d.js";import"./axios.6ec123f8.js";import"./mitt.1ea0a2a3.js";import"./vue-router.2d566cd7.js";import"./vue-clipboard2.50be9c5e.js";import"./clipboard.058ef547.js";import"./view-design-hi.92ef2000.js";import"./vuedraggable.9fd6afed.js";import"./sortablejs.d74243d9.js";import"./vue-resize-observer.c3c9ca4e.js";import"./element-sea.7f208f9b.js";import"./deepmerge.cecf392e.js";import"./resize-observer-polyfill.0bdc1850.js";import"./throttle-debounce.7c3948b2.js";import"./babel-helper-vue-jsx-merge-props.5ed215c3.js";import"./normalize-wheel.2a034b9f.js";import"./async-validator.49abba38.js";import"./babel-runtime.4773988a.js";import"./core-js.314b4a1d.js";import"./tip.5513a668.js";import"./ReportEdit.549f9961.js";import"./ReportDetail.b296400c.js";import"./add.151fb0b9.js";import"./TEditor.8fad8781.js";import"./tinymce.24840f82.js";import"./quill-hi.b7430b13.js";import"./parchment.d5c5924e.js";import"./quill-delta.f1b7ce48.js";import"./fast-diff.f17881f3.js";import"./lodash.clonedeep.e8ef3f14.js";import"./lodash.isequal.d6a986d0.js";import"./eventemitter3.78b735ad.js";import"./lodash-es.df04b444.js";import"./quill-mention-hi.0fc702d1.js";import"./vue-virtual-scroll-list-hi.2c0d691d.js";var W=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"project-archived"},[e("div",{staticClass:"archived-title"},[t._v(" "+t._s(t.$L("\u5F52\u6863\u7684\u9879\u76EE"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(a){t.$set(t.keys,"name",a)},expression:"keys.name"}})],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(a){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},J=[];const X={name:"ProjectArchived",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:s,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",s.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:200,render:(t,{row:s})=>t("AutoTip",s.name)},{title:this.$L("\u5F52\u6863\u65F6\u95F4"),key:"archived_at",width:168},{title:this.$L("\u5F52\u6863\u4EBA\u5458"),key:"archived_userid",minWidth:80,render:(t,{row:s})=>s.archived_userid?t("UserAvatar",{props:{userid:s.archived_userid,size:24,showName:!0}}):t("Tag",this.$L("\u7CFB\u7EDF\u81EA\u52A8"))},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:s})=>t("UserAvatar",{props:{showName:!0,size:22,userid:s.owner_userid}})},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(t,s)=>{const e=[t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u8FD8\u539F\u5F52\u6863\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{fontSize:"13px",cursor:"pointer",color:"#84C56A"},on:{"on-ok":()=>{this.recovery(s.row)}}},this.$L("\u8FD8\u539F")),t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u9879\u76EE\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{marginLeft:"8px",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":()=>{this.delete(s.row)}}},this.$L("\u5220\u9664"))];return t("TableAction",{props:{column:s.column}},e)}}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,archived:"yes",page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:t})=>{this.page=t.current_page,this.total=t.total,this.list=t.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(t=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},recovery(t){this.list=this.list.filter(({id:s})=>s!=t.id),this.loadIng++,this.$store.dispatch("call",{url:"project/archived",data:{project_id:t.id,type:"recovery"}}).then(()=>{this.getLists(),this.$store.dispatch("getProjectOne",t.id).catch(()=>{})}).catch(({msg:s})=>{$A.modalError(s),this.getLists()}).finally(s=>{this.loadIng--})},delete(t){this.list=this.list.filter(({id:s})=>s!=t.id),this.loadIng++,this.$store.dispatch("removeProject",t.id).then(({msg:s})=>{$A.messageSuccess(s),this.getLists()}).catch(({msg:s})=>{$A.modalError(s),this.getLists()}).finally(s=>{this.loadIng--})}}},$={};var q=n(X,W,J,!1,Q,null,null,null);function Q(t){for(let s in $)this[s]=$[s]}var Z=function(){return q.exports}(),tt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"project-management"},[e("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u6240\u6709\u9879\u76EE"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),e("div",{staticClass:"search-content"},[e("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(a){t.$set(t.keys,"name",a)},expression:"keys.name"}})],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u56E2\u961F\u9879\u76EE")},model:{value:t.keys.type,callback:function(a){t.$set(t.keys,"type",a)},expression:"keys.type"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u56E2\u961F\u9879\u76EE")))]),e("Option",{attrs:{value:"personal"}},[t._v(t._s(t.$L("\u4E2A\u4EBA\u9879\u76EE")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8\u9879\u76EE")))])],1)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u72B6\u6001"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u672A\u5F52\u6863")},model:{value:t.keys.status,callback:function(a){t.$set(t.keys,"status",a)},expression:"keys.status"}},[e("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u672A\u5F52\u6863")))]),e("Option",{attrs:{value:"archived"}},[t._v(t._s(t.$L("\u5DF2\u5F52\u6863")))]),e("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8")))])],1)],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(a){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},et=[];const at={name:"ProjectManagement",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:s,column:e})=>t("TableAction",{props:{column:e,align:"left"}},[t("div",s.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:100,render:(t,{row:s})=>{const e=[t("AutoTip",s.name)];return s.archived_at&&e.push(t("Tag",{props:{color:"error"}},this.$L("\u5DF2\u5F52\u6863"))),t("div",{class:"project-name"},e)}},{title:this.$L("\u9879\u76EE\u8FDB\u5EA6"),minWidth:100,render:(t,{row:s})=>{const e=[t("AutoTip",s.task_complete+"/"+s.task_num),t("Progress",{props:{percent:s.task_percent,strokeWidth:5}})];return t("div",{class:"project-percent"},e)}},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:s})=>t("UserAvatar",{props:{showName:!0,size:22,userid:s.owner_userid}})},{title:this.$L("\u521B\u5EFA\u4EBA"),minWidth:80,render:(t,{row:s})=>t("UserAvatar",{props:{showName:!0,size:22,userid:s.userid}})},{title:this.$L("\u521B\u5EFA\u65F6\u95F4"),key:"created_at",width:168}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){let t="team";this.keys.type=="all"?t="all":this.keys.type=="personal"&&(t="personal");let s="no";this.keys.status=="all"?s="all":this.keys.status=="archived"&&(s="yes"),this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,all:1,archived:s,type:t,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:e})=>{this.page=e.current_page,this.total=e.total,this.list=e.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(e=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()}}},k={};var st=n(at,tt,et,!1,it,null,null,null);function it(t){for(let s in k)this[s]=k[s]}var ot=function(){return st.exports}(),rt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"mobile-tabbar"},[t.windowPortrait?e("NetworkException",{attrs:{type:"alert"}}):t._e(),e("ul",{staticClass:"tabbar-box"},t._l(t.navList,function(a){return e("li",{class:{active:t.activeName===a.name},on:{click:function(i){return t.toggleRoute(a.name)}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(a.icon)}}),e("div",{staticClass:"tabbar-title"},[t._v(t._s(t.$L(a.label)))]),a.name==="dashboard"?[t.dashboardTask.overdue_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.todo_count>0?e("Badge",{staticClass:"tabbar-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.todo_count}}):t._e()]:a.name==="dialog"?[e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})]:a.name==="application"?[e("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber+t.approveUnreadNumber}})]:t._e()],2)}),0)],1)},nt=[];const lt={name:"MobileTabbar",components:{NetworkException:M},data(){return{navList:[{icon:"&#xe6fb;",name:"dashboard",label:"\u4EEA\u8868\u76D8"},{icon:"&#xe6fa;",name:"project",label:"\u9879\u76EE"},{icon:"&#xe6eb;",name:"dialog",label:"\u6D88\u606F"},{icon:"&#xe6b2;",name:"contacts",label:"\u901A\u8BAF\u5F55"},{icon:"&#xe60c;",name:"application",label:"\u5E94\u7528"}]}},computed:{...d(["cacheDialogs","reportUnreadNumber","approveUnreadNumber"]),...m(["dashboardTask"]),routeName(){return this.$route.name},msgUnreadMention(){let t=0,s=0;this.cacheDialogs.some(a=>{t+=$A.getDialogUnread(a,!1),s+=$A.getDialogMention(a)}),t>999&&(t="999+"),s>999&&(s="999+");const e=this.msgTodoTotal;return e?s?`@${s}\xB7${e}`:t?`${t}\xB7${e}`:e:t?s?`${t}\xB7@${s}`:String(t):s?`@${s}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(s=>{t+=$A.getDialogNum(s)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((s,e)=>s+(e.todo_num||0),0);return t>0?(t>999?t="999+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},activeName(){return["manage-calendar","manage-file","manage-setting","manage-application","manage-approve","manage-apps"].includes(this.routeName)?"application":this.routeName==="manage-dashboard"?"dashboard":this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?"project":this.routeName==="manage-messenger"?this.$route.params.dialogAction==="contacts"?"contacts":"dialog":""}},watch:{windowActive(t){t||$A.eeuiAppSendMessage({action:"setBdageNotify",bdage:this.unreadAndOverdue})}},methods:{toggleRoute(t){this.$emit("on-click",t);let s;switch(t){case"project":s={name:"manage-project",params:{projectId:"all"}};break;case"dialog":s={name:"manage-messenger",params:{dialogAction:"dialog"}},this.routeName==="manage-messenger"&&r.emit("clickAgainDialog",!0);break;case"contacts":s={name:"manage-messenger",params:{dialogAction:"contacts"}};break;default:s={name:"manage-"+t};break}this.goForward(s)}}},y={};var ct=n(lt,rt,nt,!1,dt,null,null,null);function dt(t){for(let s in y)this[s]=y[s]}var ht=function(){return ct.exports}(),pt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"task-add"},[e("div",{staticClass:"head",class:{empty:t.addData.cascader.length==0,visible:t.cascaderShow}},[e("Cascader",{attrs:{data:t.cascaderData,clearable:!1,placeholder:t.$L("\u8BF7\u9009\u62E9\u9879\u76EE"),"load-data":t.cascaderLoadData,filterable:""},on:{"on-change":t.cascaderChange,"on-input-change":t.cascaderInputChange,"on-visible-change":function(a){t.cascaderShow=!t.cascaderShow}},model:{value:t.addData.cascader,callback:function(a){t.$set(t.addData,"cascader",a)},expression:"addData.cascader"}})],1),t.taskTemplateList.length>0?e("ul",{staticClass:"task-add-template"},t._l(t.taskTemplateList,function(a){return e("li",{key:a.id,class:{active:t.templateActiveID===a.id},on:{click:function(i){return t.setTaskTemplate(a)}}},[t._v(" "+t._s(a.name)+" ")])}),0):t._e(),e("div",{staticClass:"task-add-form"},[e("div",{staticClass:"title"},[e("Input",{ref:"input",attrs:{type:"textarea",rows:1,autosize:{minRows:1,maxRows:8},maxlength:255,placeholder:t.$L("\u4EFB\u52A1\u63CF\u8FF0"),enterkeyhint:"done"},on:{"on-keydown":t.onKeydown},model:{value:t.addData.name,callback:function(a){t.$set(t.addData,"name",a)},expression:"addData.name"}})],1),e("TEditorTask",{staticClass:"desc",attrs:{placeholder:t.$L(t.windowLandscape?"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B...\uFF08\u70B9\u51FB\u53F3\u952E\u4F7F\u7528\u5DE5\u5177\u680F\uFF09":"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B..."),placeholderFull:t.$L("\u8BE6\u7EC6\u63CF\u8FF0...")},model:{value:t.addData.content,callback:function(a){t.$set(t.addData,"content",a)},expression:"addData.content"}}),e("div",{staticClass:"advanced-option",class:{"advanced-open":t.advanced}},[e("Button",{on:{click:function(a){t.advanced=!t.advanced}}},[t._v(t._s(t.$L("\u9AD8\u7EA7\u9009\u9879")))]),e("ul",{staticClass:"advanced-priority"},t._l(t.taskPriority,function(a,i){return e("li",{key:i},[e("ETooltip",{attrs:{disabled:t.$isEEUiApp||t.windowTouch,content:t.taskPriorityContent(a)}},[e("i",{staticClass:"taskfont",style:{color:a.color},domProps:{innerHTML:t._s(t.addData.p_name==a.name?"&#xe61d;":"&#xe61c;")},on:{click:function(o){return t.choosePriority(a)}}})])],1)}),0),t.taskDays>0||t.taskTimeOpen?e("DatePicker",{attrs:{open:t.taskTimeOpen,options:t.timeOptions,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange",placement:"bottom"},on:{"on-change":function(a){return t.taskTimeChange(t.addData)},"on-open-change":t.taskTimeOpenChange},model:{value:t.addData.times,callback:function(a){t.$set(t.addData,"times",a)},expression:"addData.times"}},[e("div",{staticClass:"advanced-time",on:{click:function(a){return t.taskTimeOpenChange(!t.taskTimeOpen)}}},[e("Icon",{attrs:{type:"ios-clock-outline"}}),e("em",{style:t.addData.p_color?{backgroundColor:t.addData.p_color}:{},attrs:{type:"primary"}},[t._v(t._s(t.taskDays))])],1)]):t._e()],1)],1),t.advanced?e("Form",t._b({staticClass:"task-add-advanced",nativeOn:{submit:function(a){a.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{label:t.$L("\u8BA1\u5212\u65F6\u95F4")}},[e("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(a){return t.taskTimeChange(t.addData)}},model:{value:t.addData.times,callback:function(a){t.$set(t.addData,"times",a)},expression:"addData.times"}})],1),e("FormItem",{attrs:{label:t.$L("\u8D1F\u8D23\u4EBA")}},[e("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:t.addData.owner,callback:function(a){t.$set(t.addData,"owner",a)},expression:"addData.owner"}})],1),e("FormItem",{attrs:{label:t.$L("\u534F\u52A9\u4EBA\u5458")}},[e("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u534F\u52A9\u4EBA\u5458"),"project-id":t.addData.project_id,"disabled-choice":t.addData.owner,"avatar-size":24,border:""},model:{value:t.addData.assist,callback:function(a){t.$set(t.addData,"assist",a)},expression:"addData.assist"}})],1),e("FormItem",[e("div",{staticClass:"visibility-text",attrs:{slot:"label"},on:{click:t.showCisibleDropdown},slot:"label"},[t._v(" "+t._s(t.$L("\u53EF\u89C1\u6027"))+" "),e("i",{staticClass:"taskfont"},[t._v("\uE740")])]),t.addData.visibility_appoint==1||t.addData.visibility_appoint==2?e("div",{ref:"visibilityText",staticClass:"ivu-input task-add-visibility",on:{click:t.showCisibleDropdown}},[t._v(" "+t._s(t.addData.visibility_appoint==1?t.$L("\u9879\u76EE\u4EBA\u5458\u53EF\u89C1"):t.$L("\u4EFB\u52A1\u4EBA\u5458\u53EF\u89C1"))+" ")]):e("UserSelect",{ref:"visibleUserSelectRef",attrs:{"avatar-size":24,title:t.$L("\u9009\u62E9\u6307\u5B9A\u4EBA\u5458"),"project-id":t.addData.project_id,border:""},on:{"on-show-change":t.visibleUserSelectShowChange},model:{value:t.addData.visibility_appointor,callback:function(a){t.$set(t.addData,"visibility_appointor",a)},expression:"addData.visibility_appointor"}})],1),e("EDropdown",{ref:"eDropdownRef",staticClass:"calculate-dropdown",attrs:{trigger:"click",placement:"bottom"},on:{command:t.dropVisible}},[e("div",{staticClass:"calculate-content"}),e("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("EDropdownItem",{attrs:{command:1}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==1?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u9879\u76EE\u4EBA\u5458"))+" ")],1)]),e("EDropdownItem",{attrs:{command:2}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==2?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u4EFB\u52A1\u4EBA\u5458"))+" ")],1)]),e("EDropdownItem",{attrs:{command:3}},[e("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==3?e("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):e("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u6307\u5B9A\u6210\u5458"))+" ")],1)])],1)],1),e("div",{staticClass:"subtasks"},[t.addData.subtasks.length>0?e("div",{staticClass:"sublist"},[e("Row",[e("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u63CF\u8FF0")))]),e("Col",{attrs:{span:"8"}},[t._v(t._s(t.$L("\u8BA1\u5212\u65F6\u95F4")))]),e("Col",{attrs:{span:"4"}},[t._v(t._s(t.$L("\u8D1F\u8D23\u4EBA")))])],1),t._l(t.addData.subtasks,function(a,i){return e("Row",{key:i},[e("Col",{attrs:{span:"12"}},[e("Input",{attrs:{maxlength:255,clearable:""},on:{"on-clear":function(o){return t.addData.subtasks.splice(i,1)}},model:{value:a.name,callback:function(o){t.$set(a,"name",o)},expression:"item.name"}})],1),e("Col",{attrs:{span:"8",title:t.timeTitle(a.times)}},[e("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u65F6\u95F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(o){return t.taskTimeChange(a)}},model:{value:a.times,callback:function(o){t.$set(a,"times",o)},expression:"item.times"}})],1),e("Col",{attrs:{span:"4"}},[e("UserSelect",{attrs:{"multiple-max":1,title:t.$L("\u9009\u62E9\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:a.owner,callback:function(o){t.$set(a,"owner",o)},expression:"item.owner"}})],1)],1)})],2):t._e(),e("Input",{class:["enter-input",t.subName==""?"empty":""],attrs:{type:"text",placeholder:t.$L("+ \u8F93\u5165\u5B50\u4EFB\u52A1\uFF0C\u56DE\u8F66\u6DFB\u52A0\u5B50\u4EFB\u52A1")},on:{"on-enter":t.addSubTask},model:{value:t.subName,callback:function(a){t.subName=a},expression:"subName"}})],1)],1):t._e(),e("div",{staticClass:"ivu-modal-footer"},[e("div",{staticClass:"adaption"},[e("Button",{attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("ButtonGroup",{staticClass:"page-manage-add-task-button-group"},[e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:function(a){return t.onAdd(!1)}}},[t._v(t._s(t.$L("\u6DFB\u52A0\u4EFB\u52A1")))]),e("Dropdown",{attrs:{transfer:""},on:{"on-click":function(a){return t.onAdd(!0)}}},[e("Button",{attrs:{type:"primary"}},[e("Icon",{attrs:{type:"ios-arrow-down"}})],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{disabled:t.loadIng>0}},[t._v(t._s(t.$L("\u63D0\u4EA4\u7EE7\u7EED\u6DFB\u52A0")))])],1)],1)],1)],1)]),e("TaskExistTips",{ref:"taskExistTipsRef",on:{onContinue:function(a){return t.onAdd(t.addContinue,!0)}}})],1)},ut=[];const mt={name:"TaskAdd",components:{TEditorTask:B,UserSelect:f,TaskExistTips:E},props:{value:{type:Boolean,default:!1}},data(){return{addData:{cascader:[],name:"",content:"",owner:[],assist:[],project_id:0,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:"",visibility_appoint:1,visibility_appointor:[]},addDefault:{},cascaderShow:!1,cascaderData:[],cascaderValue:"",cascaderLoading:0,cascaderAlready:[],advanced:!1,subName:"",taskTimeOpen:!1,timeOptions:{shortcuts:$A.timeOptionShortcuts()},loadIng:0,isMounted:!1,beforeClose:[],addContinue:!1,templateActiveID:0,templateCompareData:{name:"",content:""}}},created(){this.addDefault=$A.cloneJSON(this.addData)},async mounted(){this.initCascaderData(),await this.initProjectData(),this.$nextTick(()=>{this.$refs.input.focus(),this.templateCompareData={name:this.addData.name,content:this.addData.content}}),this.isMounted=!0},beforeDestroy(){this.beforeClose.some(t=>{typeof t=="function"&&t()}),this.beforeClose=[]},computed:{...d(["cacheProjects","projectId","cacheColumns","taskPriority","taskTemplates","formOptions"]),taskDays(){const{times:t}=this.addData,s=$A.newDateString(t,"YYYY-MM-DD HH:mm");if(s[0]&&s[1]){const e=Math.ceil($A.dayjs(s[1]).diff(s[0],"day",!0));if(e>0)return e}return 0},taskTemplateList(){return this.taskTemplates.filter(({project_id:t})=>t==this.addData.project_id)||[]}},watch:{"addData.owner"(t,s){JSON.stringify(t)!==JSON.stringify(s)&&(this.addData.assist=this.addData.assist.filter(e=>t.indexOf(e)===-1),this.addData.assist.length===0&&t.indexOf(this.userId)===-1&&(this.addData.assist=[this.userId]))},"addData.project_id"(t){t>0&&($A.IDBSave("cacheAddTaskProjectId",t),this.$store.dispatch("updateTaskTemplates",t).then(this.setTaskDefaultTemplate))},"addData.column_id"(t){t>0&&$A.IDBSave("cacheAddTaskColumnId",t);const{project_id:s}=this.addData;s&&t?this.$set(this.addData,"cascader",[s,t]):this.$set(this.addData,"cascader",[])}},methods:{initCascaderData(){const t=$A.cloneJSON(this.cacheProjects).sort((s,e)=>s.top_at||e.top_at?$A.sortDay(e.top_at,s.top_at):e.id-s.id);this.cascaderData=t.map(s=>{const e=this.cacheColumns.filter(({project_id:i})=>i==s.id).map(i=>({value:i.id,label:i.name})),a={value:s.id,label:s.name,children:e};return e.length==0&&(a.loading=!1),a})},async initProjectData(){let t=await $A.IDBInt("cacheAddTaskProjectId"),s=this.cacheProjects.find(({id:e})=>e==this.projectId)||this.cacheProjects.find(({id:e})=>e==t)||this.cacheProjects.find(({id:e})=>e>0);if(s){let e=await $A.IDBInt("cacheAddTaskColumnId"),a=this.cacheColumns.find(({project_id:i,id:o})=>i==s.id&&o==e)||this.cacheColumns.find(({project_id:i})=>i==s.id);a?(this.addData.project_id=a.project_id,this.addData.column_id=a.id):this.$store.dispatch("getColumns",s.id).then(()=>{a=this.cacheColumns.find(({project_id:i,id:o})=>i==s.id&&o==e)||this.cacheColumns.find(({project_id:i})=>i==s.id),a&&(this.addData.project_id=a.project_id,this.addData.column_id=a.id)}).catch(()=>{})}this.taskPriority.length>0&&await this.choosePriority(this.taskPriority[0])},async taskTimeChange(t){const s=$A.newDateString(t.times,"YYYY-MM-DD HH:mm");/\s+(00:00|23:59)$/.test(s[0])&&/\s+(00:00|23:59)$/.test(s[1])&&this.$set(t,"times",await this.$store.dispatch("taskDefaultTime",s))},taskTimeOpenChange(t){this.taskTimeOpen=t},timeTitle(t){return t?$A.newDateString(t):null},onKeydown(t){if(t.keyCode===13){if(t.shiftKey)return;t.preventDefault(),this.onAdd()}},addSubTask(){this.subName.trim()!==""&&(this.addData.subtasks.push({name:this.subName.trim(),owner:[this.userId],times:[]}),this.subName="")},taskPriorityContent(t){const s=$A.runNum(t.days);return s<=0?t.name+" ("+this.$L("\u65E0\u65F6\u95F4\u9650\u5236")+")":t.name+" ("+s+this.$L("\u5929")+")"},async choosePriority(t){const s=$A.daytz(),e=$A.runNum(t.days);if(e>0){const a=s.clone().add(e,"day");this.$set(this.addData,"times",await this.$store.dispatch("taskDefaultTime",$A.newDateString([s,a])))}else this.$set(this.addData,"times",[]);this.$set(this.addData,"p_level",t.priority),this.$set(this.addData,"p_name",t.name),this.$set(this.addData,"p_color",t.color)},cascaderLoadData(t,s){t.loading=!0,this.$store.dispatch("getColumns",t.value).then(e=>{t.children=e.map(a=>({value:a.id,label:a.name})),t.loading=!1,s()}).catch(()=>{t.loading=!1,s()})},cascaderChange(t){t[1]&&(this.$set(this.addData,"project_id",t[0]),this.$set(this.addData,"column_id",t[1]))},cascaderInputChange(t){this.cascaderValue=t||"",this.cascaderAlready[this.cascaderValue]!==!0&&(this.cascaderAlready[this.cascaderValue]=!0,setTimeout(()=>{this.cascaderLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.cascaderValue},getcolumn:"yes"}).then(()=>{this.cascaderLoading--,this.initCascaderData()}).catch(()=>{this.cascaderLoading--}))},setData(t){if(!this.isMounted){this.__setData&&clearTimeout(this.__setData),this.__setData=setTimeout(s=>this.setData(t),10);return}typeof t.beforeClose!="undefined"&&(this.beforeClose.push(t.beforeClose),delete t.beforeClose),this.addData=Object.assign({},this.addData,t)},async onAdd(t=!1,s=!1){if(!this.addData.name){$A.messageError("\u4EFB\u52A1\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");return}if(!s&&this.addData.owner.length>0){this.loadIng++,this.$refs.taskExistTipsRef.isExistTask({userids:this.addData.owner,timerange:this.addData.times},600).then(e=>{e?this.addContinue=t:this.onAdd(t,!0),this.loadIng--});return}this.loadIng++,this.$store.dispatch("taskAdd",this.addData).then(({msg:e})=>{$A.messageSuccess(e),t===!0?(this.addData=Object.assign({},this.addData,this.templateCompareData,{subtasks:[]}),this.$refs.input.focus()):(this.addData=$A.cloneJSON(this.addDefault),this.close())}).catch(({msg:e})=>{$A.modalError(e)}).finally(()=>{this.loadIng--})},close(){this.$emit("input",!this.value)},showCisibleDropdown(t){var i;let s=null;if(t===null?s=(i=this.$refs.visibilityText)==null?void 0:i.getBoundingClientRect():s=t.target.getBoundingClientRect(),s===null)return;const e=this.$el.getBoundingClientRect(),a=this.$refs.eDropdownRef.$el;a.style.top=s.top-e.top+"px",a.style.left=s.left-e.left+"px",a.style.width=s.width+"px",a.style.height=s.height+"px",this.$refs.eDropdownRef.visible&&this.$refs.eDropdownRef.hide(),setTimeout(()=>{this.$refs.eDropdownRef.show()},0)},visibleUserSelectShowChange(t){if(!t&&(this.addData.visibility_appointor.length==0||!this.addData.visibility_appointor[0])){let s=this.addData.old_visibility_appoint;this.addData.visibility_appoint=s>2?1:s||1,this.addData.visibility_appoint<3}},dropVisible(t){switch(t){case 1:case 2:this.addData.visibility_appoint=t;break;case 3:this.addData.old_visibility_appoint=this.addData.visibility_appoint,this.addData.visibility_appoint=t,this.$nextTick(()=>{this.$refs.visibleUserSelectRef.onSelection()});break}},setTaskTemplate(t,s=!1){if(s){this.templateActiveID=t.id,this.addData.name=t.title,this.addData.content=U(t.content,{sanitize:!1}),this.$nextTick(()=>{this.$refs.input.focus(),this.templateCompareData={name:this.addData.name,content:this.addData.content}});return}this.addData.name!==this.templateCompareData.name&&this.addData.name!==""||this.addData.content!==this.templateCompareData.content&&this.addData.content!==""?$A.modalConfirm({content:"\u5F53\u524D\u5DF2\u6709\u4FEE\u6539\u7684\u5185\u5BB9\uFF0C\u662F\u5426\u8981\u8986\u76D6\uFF1F",onOk:()=>this.setTaskTemplate(t,!0)}):this.setTaskTemplate(t,!0)},setTaskDefaultTemplate(){const t=this.taskTemplateList.find(({is_default:s})=>s);t&&this.setTaskTemplate(t)}}},b={};var ft=n(mt,pt,ut,!1,gt,null,null,null);function gt(t){for(let s in b)this[s]=b[s]}var vt=function(){return ft.exports}(),_t=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"mobile-back"},[t.isVisible&&t.x>20?e("div",{staticClass:"back-semicircle",style:t.style}):t._e()])},$t=[];const kt={name:"MobileBack",props:{showTabbar:{type:Boolean,default:!1}},data(){return{x:0,y:0,isVisible:!1,isTouched:!1,isScrolling:void 0,touchesStart:{}}},created(){this.appAndroidEvents()},mounted(){document.addEventListener("touchstart",this.touchstart),document.addEventListener("touchmove",this.touchmove,{passive:!1}),document.addEventListener("touchend",this.touchend)},beforeDestroy(){document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)},computed:{...d(["fileLists","messengerSearchKey"]),style(){const s=Math.max(135,this.y)+this.windowScrollY,e=this.windowHeight-135;return{top:Math.min(s,e)+"px"}},routeName(){return this.$route.name},fileFolderId(){const{folderId:t}=this.$route.params;return parseInt(/^\d+$/.test(t)?t:0)}},watch:{isVisible(t){this.$store.state.touchBackInProgress=t}},methods:{getXY(t){const s=t.touches[0];this.x=s.clientX,this.y=s.clientY},touchstart(t){this.getXY(t),this.isTouched=this.canBack()&&this.x<20,this.isScrolling=void 0,this.touchesStart.x=t.type==="touchstart"?t.targetTouches[0].pageX:t.pageX,this.touchesStart.y=t.type==="touchstart"?t.targetTouches[0].pageY:t.pageY},touchmove(t){if(!this.isTouched)return;const s=t.type==="touchmove"?t.targetTouches[0].pageX:t.pageX,e=t.type==="touchmove"?t.targetTouches[0].pageY:t.pageY;if(typeof this.isScrolling=="undefined"&&(this.isScrolling=!!(this.isScrolling||Math.abs(e-this.touchesStart.y)>Math.abs(s-this.touchesStart.x))),this.isScrolling){this.isTouched=!1;return}this.isVisible=!0,this.getXY(t),t.preventDefault()},touchend(){this.x>90&&this.isVisible&&this.onBack(),this.x=0,this.isVisible=!1},canBack(){if(!this.showTabbar||this.$Modal.visibles().length>0||this.fileFolderId>0)return!0;if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts)return!0}else if(this.messengerSearchKey.dialog)return!0}let t=!1;return _.setGlobalData({type:"modalVisible",callback:(s,e)=>{e&&(t=!0)}}),!!t},onBack(){let t=!1;if(_.setGlobalData({type:"route",action:"back",route:this.$route,callback:(s,e)=>{e&&(t=!0)}}),!t&&!this.$Modal.removeLast()){if(this.routeName==="manage-file"){if(this.fileFolderId>0){const s=this.fileLists.find(({id:e,permission:a})=>e==this.fileFolderId&&a>-1);if(s){const e=this.fileLists.find(({id:a,permission:i})=>a==s.pid&&i>-1);if(e){this.goForward({name:"manage-file",params:{folderId:e.id,fileId:null}});return}}this.goForward({name:"manage-file"});return}this.goForward({name:"manage-application"},!0);return}if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts){this.$store.state.messengerSearchKey.contacts="";return}}else if(this.messengerSearchKey.dialog){this.$store.state.messengerSearchKey.dialog="";return}}this.goBack()}},appAndroidEvents(){this.$isEEUiApp&&$A.isAndroid()&&$A.eeuiAppSetPageBackPressed({pageName:"firstPage"},t=>{this.canBack()?this.onBack():$A.eeuiAppGoDesktop()})}}},w={};var yt=n(kt,_t,$t,!1,bt,null,null,null);function bt(t){for(let s in w)this[s]=w[s]}var wt=function(){return yt.exports}(),Dt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return t.show&&t.userid>0?e("transition",{attrs:{name:"mobile-notify"}},[e("div",{staticClass:"mobile-notification",class:{show:t.show},style:t.notifyStyle,on:{click:function(a){return a.stopPropagation(),t.onClick.apply(null,arguments)},touchstart:t.onTouchstart,touchmove:t.onTouchmove}},[e("UserAvatar",{attrs:{userid:t.userid,size:40,"show-name":"","name-text":t.title}}),e("div",{staticClass:"notification-desc no-dark-content"},[t._v(t._s(t.desc))])],1)]):t._e()},Ct=[];const Lt={name:"MobileNotification",data(){return{userid:0,title:"",desc:"",duration:6e3,callback:null,show:!1,timer:null,startY:0}},beforeDestroy(){this.timer&&clearTimeout(this.timer),this.show=!1},computed:{notifyStyle(){return{marginTop:this.$store.state.windowScrollY+"px"}}},methods:{open(t){!$A.isJson(t)||(this.userid=t.userid||0,this.title=t.title||"",this.desc=t.desc||"",this.duration=typeof t.duration=="number"?t.duration:6e3,this.callback=typeof t.callback=="function"?t.callback:null,this.show=!0,this.timer&&clearTimeout(this.timer),this.duration>0&&(this.timer=setTimeout(this.close,this.duration)),$A.eeuiAppSendMessage({action:"setVibrate"}))},close(){this.show=!1},onClick(){this.close(),typeof this.callback=="function"&&this.callback()},onTouchstart(t){this.startY=t.touches[0].clientY},onTouchmove(t){this.startY>0&&this.startY-t.touches[0].clientY>10&&(this.startY=0,this.close())}}},D={};var Tt=n(Lt,Dt,Ct,!1,xt,null,null,null);function xt(t){for(let s in D)this[s]=D[s]}var St=function(){return Tt.exports}(),It=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Modal",{attrs:{value:t.visible,mask:!1,"mask-closable":!1,"footer-hide":!0,"transition-names":["mobile-dialog",""],beforeClose:t.onBeforeClose,"class-name":`dialog-modal${t.closIng>0?" dialog-closing":""}`,fullscreen:""}},[t.windowPortrait&&t.dialogId>0?e("DialogWrapper",{attrs:{dialogId:t.dialogId,beforeBack:t.onBeforeClose,location:"modal"}}):t._e()],1)},At=[];const Mt={name:"DialogModal",components:{DialogWrapper:F},data(){return{timer:null,closIng:!1}},computed:{...d(["dialogId"]),visible(){return this.dialogId>0&&this.windowPortrait}},watch:{visible(t){$A.eeuiAppSetScrollEnabled(!t)}},methods:{onBeforeClose(){return new Promise(async t=>{this.closIng++,await this.$store.dispatch("openDialog",0),setTimeout(()=>{this.closIng--},300)})}}},C={};var jt=n(Mt,It,At,!1,Pt,null,null,null);function Pt(t){for(let s in C)this[s]=C[s]}var Nt=function(){return jt.exports}(),Rt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Modal",{attrs:{value:t.show,styles:t.styles,"mask-closable":!1,"footer-hide":!0,beforeClose:t.onBeforeClose,"class-name":"task-modal"}},[e("TaskDetail",{ref:"taskDetail",attrs:{"task-id":t.taskId,"open-task":t.taskData,modalMode:""}})],1)},Bt=[];const Et={name:"TaskModal",components:{TaskDetail:O},computed:{...d(["taskId"]),...m(["taskData"]),show(){return this.taskId>0},styles(){return{width:"90%",maxWidth:this.taskData.dialog_id?"1200px":"700px"}}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openTask",0)})},checkUpdate(){if(this.show)return this.$refs.taskDetail.checkUpdate(!0),!0}}},L={};var Ot=n(Et,Rt,Bt,!1,Ut,null,null,null);function Ut(t){for(let s in L)this[s]=L[s]}var zt=function(){return Ot.exports}(),Ft=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("Modal",{attrs:{title:t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1"),"mask-closable":!1},model:{value:t.show,callback:function(a){t.show=a},expression:"show"}},[e("Form",t._b({ref:"exportTask",attrs:{model:t.formData},nativeOn:{submit:function(a){a.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{label:t.$L("\u5BFC\u51FA\u6210\u5458")}},[e("UserSelect",{attrs:{"multiple-max":100,"avatar-name":"","show-disable":"",title:t.$L("\u8BF7\u9009\u62E9\u6210\u5458")},model:{value:t.formData.userid,callback:function(a){t.$set(t.formData,"userid",a)},expression:"formData.userid"}}),e("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6BCF\u6B21\u6700\u591A\u9009\u62E9\u5BFC\u51FA100\u4E2A\u6210\u5458")))])],1),e("FormItem",{attrs:{label:t.$L("\u65F6\u95F4\u8303\u56F4")}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy/MM/dd",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.formData.time,callback:function(a){t.$set(t.formData,"time",a)},expression:"formData.time"}}),e("div",{staticClass:"form-tip form-quick-select"},[e("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),e("em",{on:{click:function(a){t.formData.time=t.dateShortcuts("prev")}}},[t._v(t._s(t.$L("\u4E0A\u4E2A\u6708")))]),e("em",{on:{click:function(a){t.formData.time=t.dateShortcuts("this")}}},[t._v(t._s(t.$L("\u8FD9\u4E2A\u6708")))])])],1),e("FormItem",{attrs:{prop:"type",label:t.$L("\u5BFC\u51FA\u65F6\u95F4\u7C7B\u578B")}},[e("RadioGroup",{model:{value:t.formData.type,callback:function(a){t.$set(t.formData,"type",a)},expression:"formData.type"}},[e("Radio",{attrs:{label:"taskTime"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u65F6\u95F4")))]),e("Radio",{attrs:{label:"createdTime"}},[t._v(t._s(t.$L("\u521B\u5EFA\u65F6\u95F4")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onExport}},[t._v(t._s(t.$L("\u5BFC\u51FA")))])],1)],1)},Yt=[];const Vt={name:"TaskExport",components:{UserSelect:f},props:{value:{type:Boolean,default:!1}},data(){return{show:this.value,loadIng:0,formData:{userid:[],time:[],type:"taskTime"}}},watch:{value(t){this.show=t},show(t){this.value!==t&&this.$emit("input",t)}},computed:{...d(["formOptions"])},methods:{dateShortcuts(t){if(t==="prev")return[$A.daytz().subtract(1,"month").startOf("month").format("YYYY-MM-DD"),$A.daytz().subtract(1,"month").endOf("month").format("YYYY-MM-DD")];if(t==="this")return[$A.daytz().startOf("month").format("YYYY-MM-DD"),$A.daytz().endOf("month").format("YYYY-MM-DD")]},onExport(){this.loadIng>0||(this.loadIng++,this.$store.dispatch("call",{url:"project/task/export",data:this.formData}).then(()=>{this.show=!1,$A.modalSuccess("\u6B63\u5728\u6253\u5305\uFF0C\u8BF7\u7559\u610F\u7CFB\u7EDF\u6D88\u606F\u3002")}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))}}},T={};var Kt=n(Vt,Ft,Yt,!1,Gt,null,null,null);function Gt(t){for(let s in T)this[s]=T[s]}var Ht=function(){return Kt.exports}(),Wt=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"project-management"},[e("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u4E3E\u62A5\u7BA1\u7406"))+" "),e("div",{staticClass:"title-icon"},[t.loadIng>0?e("Loading"):t._e()],1)]),e("div",{staticClass:"search-container lr"},[e("ul",[e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u4E3E\u62A5\u7C7B\u578B"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.type,callback:function(a){t.$set(t.keys,"type",a)},expression:"keys.type"}},[e("Option",{attrs:{value:" "}},[t._v(t._s(t.$L("\u5168\u90E8")))]),t._l(t.typeList,function(a,i){return e("Option",{key:i,attrs:{value:a.id}},[t._v(t._s(t.$L(a.label))+" ")])})],2)],1)]),e("li",[e("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u4E3E\u62A5\u72B6\u6001"))+" ")]),e("div",{staticClass:"search-content"},[e("Select",{attrs:{placeholder:t.$L("\u5168\u90E8")},model:{value:t.keys.status,callback:function(a){t.$set(t.keys,"status",a)},expression:"keys.status"}},[e("Option",{attrs:{value:" "}},[t._v(t._s(t.$L("\u5168\u90E8")))]),e("Option",{attrs:{value:0}},[t._v(t._s(t.$L("\u5F85\u5904\u7406")))]),e("Option",{attrs:{value:1}},[t._v(t._s(t.$L("\u5DF2\u5904\u7406")))])],1)],1)]),e("li",{staticClass:"search-button"},[e("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[e("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),e("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?e("Button",{attrs:{type:"text"},on:{click:function(a){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):e("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),e("div",{staticClass:"table-page-box"},[e("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),e("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},Jt=[];const Xt={name:"ComplaintManagement",data(){const t=[{id:10,label:"\u8BC8\u9A97\u8BF1\u5BFC\u8F6C\u8D26"},{id:20,label:"\u5F15\u6D41\u4E0B\u8F7D\u5176\u4ED6APP\u4ED8\u8D39"},{id:30,label:"\u6572\u8BC8\u52D2\u7D22"},{id:40,label:"\u7167\u7247\u4E0E\u672C\u4EBA\u4E0D\u4E00\u81F4"},{id:50,label:"\u8272\u60C5\u4F4E\u4FD7"},{id:60,label:"\u9891\u7E41\u5E7F\u544A\u9A9A\u6270"},{id:70,label:"\u5176\u4ED6\u95EE\u9898"}];return{loadIng:0,keys:{},keyIs:!1,typeList:t,columns:[{title:"ID",key:"id",width:80,render:(s,{row:e,column:a})=>s("TableAction",{props:{column:a,align:"left"}},[s("div",e.id)])},{title:this.$L("\u4E3E\u62A5\u7C7B\u578B"),key:"type",minWidth:120,render:(s,{row:e})=>{const a=this.$L(t.find(i=>i.id==e.type).label);return s("div",{style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},on:{click:()=>{$A.modalInfo({language:!1,title:this.$L("\u4E3E\u62A5\u7C7B\u578B"),content:a})}}},a)}},{title:this.$L("\u72B6\u6001"),key:"status",minWidth:80,render:(s,{row:e})=>{let a=e.status==0?"\u672A\u5904\u7406":"\u5DF2\u5904\u7406";return s("div",{style:{color:e.status==0?"#f00":"inherit"}},[s("AutoTip",this.$L(a))])}},{title:this.$L("\u4E3E\u62A5\u539F\u56E0"),minWidth:150,render:(s,{row:e})=>s("div",{style:{overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},on:{click:()=>{$A.modalInfo({language:!1,title:this.$L("\u4E3E\u62A5\u539F\u56E0"),content:e.reason})}}},e.reason)},{title:this.$L("\u4E3E\u62A5\u56FE"),minWidth:85,render:(s,{row:e})=>{var i;const a=(i=JSON.parse(e.imgs))==null?void 0:i.map(o=>({src:$A.apiUrl("../"+o)}));return a.length===0?s("div","-"):s("div",{style:{color:"#1890ff"},on:{click:()=>{this.$store.dispatch("previewImage",{index:0,list:a})}}},[s("AutoTip",this.$L("\u70B9\u51FB\u67E5\u770B"))])}},{title:this.$L("\u4E3E\u62A5\u4EBA"),minWidth:100,render:(s,{row:e})=>s("UserAvatar",{props:{showName:!0,size:22,userid:e.userid}})},{title:this.$L("\u521B\u5EFA\u65F6\u95F4"),key:"created_at",width:168},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(s,e)=>{const a=[e.row.status==0&&s("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5904\u7406\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{fontSize:"13px",cursor:"pointer",color:"#84C56A"},on:{"on-ok":()=>{this.handle(e.row)}}},this.$L("\u5904\u7406")),s("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{marginLeft:e.row.status==0?"8px":"0",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":()=>{this.delete(e.row)}}},this.$L("\u5220\u9664"))];return s("TableAction",{props:{column:e.column}},a)}}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.$store.dispatch("call",{url:"complaint/lists",data:{type:this.keys.type,status:this.keys.status,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:t})=>{this.page=t.current_page,this.total=t.total,this.list=t.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(t=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},handle(t){this.loadIng++,this.$store.dispatch("call",{url:"complaint/action",data:{id:t.id,type:"handle"}}).then(()=>{this.getLists()}).catch(({msg:s})=>{$A.modalError(s)}).finally(s=>{this.loadIng--})},delete(t){this.list=this.list.filter(({id:s})=>s!=t.id),this.loadIng++,this.$store.dispatch("call",{url:"complaint/action",data:{id:t.id,type:"delete"}}).then(()=>{this.getLists()}).catch(({msg:s})=>{$A.modalError(s),this.getLists()}).finally(s=>{this.loadIng--})}}},x={};var qt=n(Xt,Wt,Jt,!1,Qt,null,null,null);function Qt(t){for(let s in x)this[s]=x[s]}var Zt=function(){return qt.exports}(),te=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ModalAlive",{attrs:{"class-name":"common-search-box-modal",closable:!t.isFullscreen,fullscreen:t.isFullscreen,"mask-closable":!1,"footer-hide":!0,width:"768"},model:{value:t.showModal,callback:function(a){t.showModal=a},expression:"showModal"}},[e("div",{staticClass:"search-header"},[e("div",{staticClass:"search-input"},[e("div",{staticClass:"search-pre"},[t.loadIng>0?e("Loading"):e("Icon",{attrs:{type:"ios-search"}})],1),e("Form",{staticClass:"search-form",attrs:{action:"javascript:void(0)"},nativeOn:{submit:function(a){return a.preventDefault(),t.$A.eeuiAppKeyboardHide.apply(null,arguments)}}},[e("Input",{ref:"searchKey",attrs:{type:"search",placeholder:t.$L("\u8BF7\u8F93\u5165\u5173\u952E\u5B57")},model:{value:t.searchKey,callback:function(a){t.searchKey=a},expression:"searchKey"}})],1)],1),e("div",{staticClass:"search-close",on:{click:t.onHide}},[e("i",{staticClass:"taskfont"},[t._v("\uE6E5")])])]),e("div",{staticClass:"search-body",on:{touchstart:t.onTouchstart}},[e("div",{staticClass:"search-tags"},t._l(t.tags,function(a){return e("div",{key:a.type,staticClass:"tag-item",class:{action:a.type===t.action},on:{click:function(i){return t.onTag(a.type,i)}}},[e("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(a.icon)}}),e("span",[t._v(t._s(t.$L(a.name)))]),a.type===t.action?e("i",{staticClass:"taskfont tag-close"},[t._v("\uE747")]):t._e()])}),0),t.total===0?[t.loadIng+t.loadPre>0||!t.searchKey.trim()?e("div",{staticClass:"search-empty"},[e("i",{staticClass:"taskfont"},[t._v("\uE60B")]),e("span",[t._v(t._s(t.$L(t.loadIng+t.loadPre>0?"\u6B63\u5728\u62FC\u547D\u641C\u7D22...":"\u8BF7\u8F93\u5165\u5173\u952E\u5B57\u641C\u7D22")))])]):e("div",{staticClass:"search-empty"},[e("i",{staticClass:"taskfont"},[t._v("\uE60B")]),e("span",{staticClass:"empty-label"},[t._v(t._s(t.$L("\u6682\u65E0\u76F8\u5173\u7ED3\u679C")))]),e("span",[t._v(t._s(t.$L("\u672A\u641C\u5230\u8DDF\u300C(*)\u300D\u76F8\u5173\u7684\u7ED3\u679C",t.searchKey)))])])]:e("div",{staticClass:"search-list"},t._l(t.list,function(a){return e("ul",{key:a.type},[t.action?t._e():e("li",{staticClass:"item-label"},[t._v(t._s(t.$L(a.name)))]),t._l(a.items,function(i){return e("li",{key:i.id,on:{click:function(o){return t.onClick(i)}}},[e("div",{staticClass:"item-icon"},[i.icons[0]==="file"?e("div",{class:`no-dark-content file-icon ${i.icons[1]}`}):i.icons[0]==="department"?e("i",{staticClass:"taskfont icon-avatar department"},[t._v("\uE75C")]):i.icons[0]==="project"?e("i",{staticClass:"taskfont icon-avatar project"},[t._v("\uE6F9")]):i.icons[0]==="task"?e("i",{staticClass:"taskfont icon-avatar task"},[t._v("\uE6F4")]):i.icons[0]==="user"?e("UserAvatar",{staticClass:"user-avatar",attrs:{userid:i.icons[1],size:38}}):i.icons[0]==="avatar"?e("EAvatar",{staticClass:"img-avatar",attrs:{src:i.icons[1],size:38}}):i.icons[0]==="people"?e("Icon",{staticClass:"icon-avatar",attrs:{type:"ios-people"}}):e("Icon",{staticClass:"icon-avatar",attrs:{type:"md-person"}})],1),e("div",{staticClass:"item-content"},[e("div",{staticClass:"item-title"},[e("div",{staticClass:"title-text"},[t._v(t._s(i.title))]),i.activity?e("div",{staticClass:"title-activity",attrs:{title:i.activity}},[t._v(t._s(t.activityFormat(i.activity)))]):t._e()]),e("div",{staticClass:"item-desc"},[t._l(i.tags,function(o){return i.tags?e("span",{staticClass:"desc-tag",style:o.style},[t._v(t._s(o.name))]):t._e()}),e("span",{staticClass:"desc-text",domProps:{innerHTML:t._s(i.desc)}})],2)])])})],2)}),0)],2)])},ee=[];const ae={name:"SearchBox",props:{},data(){return{loadPre:0,loadIng:0,searchKey:"",searchResults:[],searchTimer:null,showModal:!1,tags:[{type:"task",name:"\u4EFB\u52A1",icon:"&#xe6f4;"},{type:"project",name:"\u9879\u76EE",icon:"&#xe6f9;"},{type:"message",name:"\u6D88\u606F",icon:"&#xe6eb;"},{type:"contact",name:"\u8054\u7CFB\u4EBA",icon:"&#xe6b2;"},{type:"file",name:"\u6587\u4EF6",icon:"&#xe6f3;"}],action:""}},mounted(){r.on("openSearch",this.onShow)},beforeDestroy(){r.off("openSearch",this.onShow)},watch:{searchKey(){this.preSearch()},action(){this.preSearch()},showModal(t){$A.eeuiAppSetScrollEnabled(!t)}},computed:{...d(["themeName","keyboardType"]),isFullscreen({windowWidth:t}){return t<576},items({searchKey:t,searchResults:s,action:e}){return s.filter(a=>a.key===t&&(!e||a.type===e))},total(){return this.items.length},list({action:t,tags:s}){const e=new Map,a=t?1/0:10;for(let i=0;i<this.items.length;i++){const o=this.items[i],h=o.type;e.has(h)||e.set(h,[]);const p=e.get(h);p.length<a&&p.push(o)}return s.reduce((i,o)=>(e.has(o.type)&&i.push({...o,items:e.get(o.type)}),i),[])}},methods:{activityFormat(t){const s=$A.daytz(),e=$A.dayjs(t);return s.format("YYYY/MM/DD")===e.format("YYYY/MM/DD")?e.format("HH:mm"):s.year()===e.year()?e.format("MM/DD"):e.format("YYYY/MM/DD")||""},onClick(t){switch(t.type){case"task":this.$store.dispatch("openTask",t.rawData),this.onHide();break;case"project":this.goForward({name:"manage-project",params:{projectId:t.id}}),this.onHide();break;case"message":this.$store.dispatch("openDialog",t.id).then(()=>{this.onHide(),this.goForward({name:"manage-messenger",params:{dialogAction:"dialog"}}),this.$store.state.dialogSearchMsgId=/^\d+$/.test(t.rawData.search_msg_id)?t.rawData.search_msg_id:0}).catch(({msg:s})=>{$A.modalError(s||this.$L("\u6253\u5F00\u4F1A\u8BDD\u5931\u8D25"))});break;case"contact":this.$store.dispatch("openDialogUserid",t.id).then(s=>{this.onHide(),this.goForward({name:"manage-messenger",params:{dialogAction:"dialog"}})}).catch(({msg:s})=>{$A.modalError(s||this.$L("\u6253\u5F00\u4F1A\u8BDD\u5931\u8D25"))});break;case"file":this.goForward({name:"manage-file",params:{folderId:t.rawData.pid,fileId:null,shakeId:t.id}}),this.$store.state.fileShakeId=t.id,setTimeout(()=>{this.$store.state.fileShakeId=0},600),this.onHide();break}},onTouchstart(){this.keyboardType==="show"&&$A.eeuiAppKeyboardHide()},onTag(t,s){this.action=this.action!==t?t:"",$A.scrollToView(s.target,{block:"nearest",inline:"nearest",behavior:"smooth"})},onShow(){this.showModal=!0,!(this.total>0)&&this.$nextTick(()=>{var s,e;const t=(e=(s=this.$refs.searchKey)==null?void 0:s.$refs)==null?void 0:e.input;t&&(t.style.caretColor="transparent",t.focus(),setTimeout(()=>{const a=t.value.length;t.setSelectionRange(a,a),t.style.caretColor=null},300))})},onHide(){this.showModal=!1},preSearch(){!this.searchKey.trim()||(this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null,this.loadPre--),this.loadPre++,this.searchTimer=setTimeout(()=>{this.searchKey.trim()&&this.onSearch(),this.searchTimer=null,this.loadPre--},500))},onSearch(){if(this.action){this.distSearch(this.action);return}this.tags.forEach(({type:t})=>this.distSearch(t))},distSearch(t){const s=this[`search${t.charAt(0).toUpperCase()}${t.slice(1)}`];return typeof s=="function"?(s(this.searchKey),!0):!1},echoSearch(t){t.forEach(s=>{const e=this.searchResults.findIndex(({id:a,type:i})=>a===s.id&&i===s.type);e>-1?this.searchResults.splice(e,1,s):this.searchResults.push(s)})},searchTask(t){this.loadIng++,this.$store.dispatch("call",{url:"project/task/lists",data:{keys:{name:t},archived:"all",pagesize:this.action?50:10}}).then(({data:s})=>{const e=$A.dayjs().unix(),a=s.data.map(i=>{const o=[];return i.complete_at?o.push({name:this.$L("\u5DF2\u5B8C\u6210"),style:"background-color:#ccc"}):i.overdue?o.push({name:this.$L("\u8D85\u671F"),style:"background-color:#f00"}):$A.dayjs(i.end_at).unix()-e<86400&&o.push({name:this.$L("\u5373\u5C06\u5230\u671F"),style:"background-color:#f80"}),{key:t,type:"task",icons:["task",null],tags:o,id:i.id,title:i.name,desc:i.desc,activity:i.end_at,rawData:i}});this.echoSearch(a)}).finally(s=>{this.loadIng--})},searchProject(t){this.loadIng++,this.$store.dispatch("call",{url:"project/lists",data:{keys:{name:t},archived:"all",pagesize:this.action?50:10}}).then(({data:s})=>{const e=s.data.map(a=>{const i=[];return a.owner&&i.push({name:this.$L("\u8D1F\u8D23\u4EBA"),style:"background-color:#0bc037"}),a.archived_at&&i.push({name:this.$L("\u5DF2\u5F52\u6863"),style:"background-color:#ccc"}),{key:t,type:"project",icons:["project",null],tags:i,id:a.id,title:a.name,desc:a.desc||"",activity:a.updated_at,rawData:a}});this.echoSearch(e)}).finally(s=>{this.loadIng--})},searchMessage(t){this.loadIng++,this.$store.dispatch("call",{url:"dialog/msg/esearch",data:{key:t,pagesize:this.action?50:10}}).then(({data:s})=>{const e=s.data.map(a=>{let i="person",o=null;return a.type=="group"?a.avatar?(i="avatar",o=a.avatar):a.group_type=="department"?i="department":a.group_type=="project"?i="project":["task","okr"].includes(a.group_type)?i="task":i="people":a.dialog_user&&(i="user",o=a.dialog_user.userid),{key:t,type:"message",icons:[i,o],tags:[],id:a.id,title:a.name,desc:$A.getMsgSimpleDesc(a.last_msg),activity:a.last_at,rawData:a}});this.echoSearch(e)}).finally(s=>{this.loadIng--})},searchContact(t){this.loadIng++,this.$store.dispatch("call",{url:"users/search",data:{keys:{key:t},pagesize:this.action?50:10}}).then(({data:s})=>{const e=s.map(a=>({key:t,type:"contact",icons:["user",a.userid],tags:[],id:a.userid,title:a.nickname,desc:a.profession||"",activity:a.line_at,rawData:a}));this.echoSearch(e)}).finally(s=>{this.loadIng--})},searchFile(t){this.loadIng++,this.$store.dispatch("call",{url:"file/search",data:{key:t,take:this.action?50:10}}).then(({data:s})=>{const e=s.map(a=>{const i=[];return a.share&&i.push({name:this.$L(a.userid==this.userId?"\u5DF2\u5171\u4EAB":"\u5171\u4EAB"),style:"background-color:#0bc037"}),{key:t,type:"file",icons:["file",a.type],tags:i,id:a.id,title:a.name,desc:a.type==="folder"?"":$A.bytesToSize(a.size),activity:a.updated_at,rawData:a}});this.echoSearch(e)}).finally(s=>{this.loadIng--})}}},S={};var se=n(ae,te,ee,!1,ie,null,null,null);function ie(t){for(let s in S)this[s]=S[s]}var oe=function(){return se.exports}(),re=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"page-manage",class:{"show-tabbar":t.showMobileTabbar,"not-logged":t.userId<=0}},[e("div",{staticClass:"manage-box-menu",class:{"show-mobile-menu":t.showMobileMenu}},[e("Dropdown",{staticClass:"page-manage-menu-dropdown main-menu",attrs:{trigger:"click"},on:{"on-click":t.settingRoute,"on-visible-change":t.menuVisibleChange}},[e("div",{class:["manage-box-title",t.visibleMenu?"menu-visible":""]},[e("div",{staticClass:"manage-box-avatar"},[e("UserAvatar",{attrs:{userid:t.userId,size:36}})],1),e("span",[t._v(t._s(t.userInfo.nickname))]),t.clientNewVersion?e("Badge",{staticClass:"manage-box-top-report",attrs:{dot:""}}):t._e(),e("div",{staticClass:"manage-box-arrow"},[e("Icon",{attrs:{type:"ios-arrow-up"}}),e("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t._l(t.menu,function(a){return[a.path==="taskBrowse"?e("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[e("DropdownItem",{attrs:{divided:!!a.divided}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(a.name))+" "),e("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t.taskBrowseLists.length>0?e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.taskBrowseLists,function(i,o){return i.id>0&&o<10?e("DropdownItem",{key:o,staticClass:"task-title",attrs:{name:i.name},nativeOn:{click:function(h){return t.openTask(i)}}},[i.flow_item_name?e("span",{class:i.flow_item_status},[t._v(t._s(i.flow_item_name))]):t._e(),e("div",{staticClass:"task-title-text"},[t._v(t._s(i.name))])]):t._e()}),1):e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{staticStyle:{color:"darkgrey"}},[t._v(t._s(t.$L("\u6682\u65E0\u6253\u5F00\u8BB0\u5F55")))])],1)],1):a.path==="team"?e("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[e("DropdownItem",{attrs:{divided:!!a.divided}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(a.name))+" "),e("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"allUser"}},[t._v(t._s(t.$L("\u56E2\u961F\u7BA1\u7406")))]),e("DropdownItem",{attrs:{name:"exportTask"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1")))]),e("DropdownItem",{attrs:{name:"exportOverdueTask"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u8D85\u671F\u4EFB\u52A1")))]),e("DropdownItem",{attrs:{name:"exportApprove"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u5BA1\u6279\u6570\u636E")))]),e("DropdownItem",{attrs:{name:"exportCheckin"}},[t._v(t._s(t.$L("\u5BFC\u51FA\u7B7E\u5230\u6570\u636E")))])],1)],1):a.visible!==!1?e("DropdownItem",{style:a.style||{},attrs:{divided:!!a.divided,name:a.path}},[e("div",{staticClass:"manage-menu-flex"},[t._v(" "+t._s(t.$L(a.name))+" "),a.path==="version"?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{text:t.clientNewVersion}}):a.path==="workReport"&&t.reportUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.reportUnreadNumber}}):a.path==="approve"&&t.approveUnreadNumber>0?e("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.approveUnreadNumber}}):t._e()],1)]):t._e()]})],2)],1),e("Scrollbar",{attrs:{"class-name":"manage-item"},on:{"on-scroll":function(a){t.operateVisible=!1}}},[e("div",{staticClass:"menu-base"},[e("ul",[e("li",{class:t.classNameRoute("dashboard"),on:{click:function(a){return t.toggleRoute("dashboard")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6FB")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u4EEA\u8868\u76D8")))]),t.dashboardTask.overdue_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.todo_count>0?e("Badge",{staticClass:"menu-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.todo_count}}):t._e()],1),e("li",{class:t.classNameRoute("calendar"),on:{click:function(a){return t.toggleRoute("calendar")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F5")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u65E5\u5386")))])]),e("li",{class:t.classNameRoute("messenger"),on:{click:function(a){return t.toggleRoute("messenger")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6EB")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u6D88\u606F")))]),e("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})],1),e("li",{class:t.classNameRoute("file"),on:{click:function(a){return t.toggleRoute("file")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE6F3")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u6587\u4EF6")))])]),e("li",{class:t.classNameRoute("application"),on:{click:function(a){return t.toggleRoute("application")}}},[e("i",{staticClass:"taskfont"},[t._v("\uE60C")]),e("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("\u5E94\u7528")))]),e("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:String(t.reportUnreadNumber+t.approveUnreadNumber||"")}})],1)])]),e("div",{ref:"menuProject",staticClass:"menu-project"},[e("ul",[t._l(t.projectLists,function(a,i){return e("li",{directives:[{name:"longpress",rawName:"v-longpress",value:t.handleLongpress,expression:"handleLongpress"}],key:i,ref:`project_${a.id}`,refInFor:!0,class:t.classNameProject(a),attrs:{"data-id":a.id},on:{click:function(o){return t.toggleRoute("project",{projectId:a.id})}}},[e("div",{staticClass:"project-h1"},[e("em",{on:{click:function(o){return o.stopPropagation(),t.toggleOpenMenu(a.id)}}}),e("div",{staticClass:"title"},[t._v(t._s(a.name))]),a.top_at?e("div",{staticClass:"icon-top"}):t._e(),a.task_my_num-a.task_my_complete>0?e("div",{staticClass:"num"},[t._v(t._s(a.task_my_num-a.task_my_complete))]):t._e()]),e("div",{staticClass:"project-h2"},[e("p",[e("em",[t._v(t._s(t.$L("\u6211\u7684"))+":")]),e("span",[t._v(t._s(a.task_my_complete)+"/"+t._s(a.task_my_num))]),e("Progress",{attrs:{percent:a.task_my_percent,"stroke-width":6}})],1),e("p",[e("em",[t._v(t._s(t.$L("\u5168\u90E8"))+":")]),e("span",[t._v(t._s(a.task_complete)+"/"+t._s(a.task_num))]),e("Progress",{attrs:{percent:a.task_percent,"stroke-width":6}})],1)])])}),t.projectKeyLoading>0?e("li",{staticClass:"loading"},[e("Loading")],1):t._e()],2)])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.operateVisible,expression:"operateVisible"}],staticClass:"operate-position",style:t.operateStyles},[e("Dropdown",{attrs:{trigger:"custom",placement:t.windowLandscape?"bottom":"top",visible:t.operateVisible,transfer:""},on:{"on-clickoutside":function(a){t.operateVisible=!1}}},[e("div",{style:{userSelect:t.operateVisible?"none":"auto",height:t.operateStyles.height}}),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{nativeOn:{click:function(a){return t.handleTopClick.apply(null,arguments)}}},[t._v(" "+t._s(t.$L(t.operateItem.top_at?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876\u8BE5\u9879\u76EE"))+" ")])],1)],1)],1),t.projectKeyValue||(t.projectSearchShow||t.projectTotal>20)&&t.windowHeight>600?e("div",{staticClass:"manage-project-search"},[e("div",{staticClass:"search-pre"},[t.projectKeyLoading>0?e("Loading"):e("Icon",{attrs:{type:"ios-search"}})],1),e("Form",{staticClass:"search-form",attrs:{action:"javascript:void(0)"},nativeOn:{submit:function(a){return a.preventDefault(),t.$A.eeuiAppKeyboardHide.apply(null,arguments)}}},[e("Input",{attrs:{type:"search",placeholder:t.$L(`\u5171${t.projectTotal||t.cacheProjects.length}\u4E2A\u9879\u76EE\uFF0C\u641C\u7D22...`),clearable:""},model:{value:t.projectKeyValue,callback:function(a){t.projectKeyValue=a},expression:"projectKeyValue"}})],1)],1):t._e(),e("ButtonGroup",{staticClass:"manage-box-new-group"},[e("Button",{staticClass:"manage-box-new",attrs:{type:"primary",icon:"md-add"},on:{click:t.onAddShow}},[t._v(t._s(t.$L("\u65B0\u5EFA\u9879\u76EE")))]),e("Dropdown",{attrs:{trigger:"click"},on:{"on-click":t.onAddMenu}},[e("Button",{attrs:{type:"primary"}},[e("Icon",{attrs:{type:"ios-arrow-down"}})],1),e("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e("DropdownItem",{attrs:{name:"project"}},[t._v(t._s(t.$L("\u65B0\u5EFA\u9879\u76EE"))+" ("+t._s(t.mateName)+"+B)")]),e("DropdownItem",{attrs:{name:"task"}},[t._v(t._s(t.$L("\u65B0\u5EFA\u4EFB\u52A1"))+" ("+t._s(t.mateName)+"+K)")]),e("DropdownItem",{attrs:{name:"group"}},[t._v(t._s(t.$L("\u521B\u5EFA\u7FA4\u7EC4"))+" ("+t._s(t.mateName)+"+U)")]),e("DropdownItem",{attrs:{name:"createMeeting"}},[t._v(t._s(t.$L("\u65B0\u4F1A\u8BAE"))+" ("+t._s(t.mateName)+"+J)")]),e("DropdownItem",{attrs:{name:"joinMeeting"}},[t._v(t._s(t.$L("\u52A0\u5165\u4F1A\u8BAE")))])],1)],1)],1)],1),e("div",{staticClass:"manage-box-main"},[e("keep-alive",[e("router-view",{staticClass:"manage-box-view",on:{"on-click":t.onTabbarClick}})],1)],1),e("Modal",{attrs:{title:t.$L("\u65B0\u5EFA\u9879\u76EE"),"mask-closable":!1},model:{value:t.addShow,callback:function(a){t.addShow=a},expression:"addShow"}},[e("Form",t._b({ref:"addProject",attrs:{model:t.addData,rules:t.addRule},nativeOn:{submit:function(a){a.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{prop:"name",label:t.$L("\u9879\u76EE\u540D\u79F0")}},[e("Input",{ref:"projectName",attrs:{type:"text"},model:{value:t.addData.name,callback:function(a){t.$set(t.addData,"name",a)},expression:"addData.name"}})],1),t.addData.columns?e("FormItem",{attrs:{label:t.$L("\u4EFB\u52A1\u5217\u8868")}},[e("TagInput",{model:{value:t.addData.columns,callback:function(a){t.$set(t.addData,"columns",a)},expression:"addData.columns"}})],1):e("FormItem",{attrs:{label:t.$L("\u9879\u76EE\u6A21\u677F")}},[e("Select",{attrs:{value:0,placeholder:t.$L("\u8BF7\u9009\u62E9\u6A21\u677F")},on:{"on-change":t.selectChange}},t._l(t.columns,function(a,i){return e("Option",{key:i,attrs:{value:i}},[t._v(t._s(a.name))])}),1)],1),e("FormItem",{attrs:{prop:"flow",label:t.$L("\u5F00\u542F\u5DE5\u4F5C\u6D41")}},[e("RadioGroup",{model:{value:t.addData.flow,callback:function(a){t.$set(t.addData,"flow",a)},expression:"addData.flow"}},[e("Radio",{attrs:{label:"open"}},[t._v(t._s(t.$L("\u5F00\u542F")))]),e("Radio",{attrs:{label:"close"}},[t._v(t._s(t.$L("\u5173\u95ED")))])],1)],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.addShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAddProject}},[t._v(t._s(t.$L("\u6DFB\u52A0")))])],1)],1),e("Modal",{attrs:{"mask-closable":!1,styles:{width:"90%",maxWidth:"640px"},"footer-hide":""},model:{value:t.addTaskShow,callback:function(a){t.addTaskShow=a},expression:"addTaskShow"}},[e("TaskAdd",{ref:"addTask",model:{value:t.addTaskShow,callback:function(a){t.addTaskShow=a},expression:"addTaskShow"}})],1),e("Modal",{attrs:{title:t.$L("\u521B\u5EFA\u7FA4\u7EC4"),"mask-closable":!1},model:{value:t.createGroupShow,callback:function(a){t.createGroupShow=a},expression:"createGroupShow"}},[e("Form",t._b({attrs:{model:t.createGroupData},nativeOn:{submit:function(a){a.preventDefault()}}},"Form",t.formOptions,!1),[e("FormItem",{attrs:{prop:"avatar",label:t.$L("\u7FA4\u5934\u50CF")}},[e("ImgUpload",{attrs:{num:1,width:512,height:512,whcut:"cover"},model:{value:t.createGroupData.avatar,callback:function(a){t.$set(t.createGroupData,"avatar",a)},expression:"createGroupData.avatar"}})],1),e("FormItem",{attrs:{prop:"userids",label:t.$L("\u7FA4\u6210\u5458")}},[e("UserSelect",{attrs:{uncancelable:t.createGroupData.uncancelable,"multiple-max":100,"show-bot":"",title:t.$L("\u9009\u62E9\u9879\u76EE\u6210\u5458")},model:{value:t.createGroupData.userids,callback:function(a){t.$set(t.createGroupData,"userids",a)},expression:"createGroupData.userids"}})],1),e("FormItem",{attrs:{prop:"chat_name",label:t.$L("\u7FA4\u540D\u79F0")}},[e("Input",{attrs:{placeholder:t.$L("\u8F93\u5165\u7FA4\u540D\u79F0\uFF08\u9009\u586B\uFF09")},model:{value:t.createGroupData.chat_name,callback:function(a){t.$set(t.createGroupData,"chat_name",a)},expression:"createGroupData.chat_name"}})],1)],1),e("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"default"},on:{click:function(a){t.createGroupShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),e("Button",{attrs:{type:"primary",loading:t.createGroupLoad>0},on:{click:t.submitCreateGroup}},[t._v(t._s(t.$L("\u521B\u5EFA")))])],1)],1),e("TaskExport",{model:{value:t.exportTaskShow,callback:function(a){t.exportTaskShow=a},expression:"exportTaskShow"}}),e("CheckinExport",{model:{value:t.exportCheckinShow,callback:function(a){t.exportCheckinShow=a},expression:"exportCheckinShow"}}),e("ApproveExport",{model:{value:t.exportApproveShow,callback:function(a){t.exportApproveShow=a},expression:"exportApproveShow"}}),e("TaskModal",{ref:"taskModal"}),e("DialogModal",{ref:"dialogModal"}),e("SearchBox",{ref:"searchBox"}),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.workReportShow,callback:function(a){t.workReportShow=a},expression:"workReportShow"}},[t.workReportShow?e("Report",{on:{"on-read":function(a){return t.$store.dispatch("getReportUnread",1e3)}},model:{value:t.reportTabs,callback:function(a){t.reportTabs=a},expression:"reportTabs"}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1380},model:{value:t.allUserShow,callback:function(a){t.allUserShow=a},expression:"allUserShow"}},[t.allUserShow?e("TeamManagement",{on:{"on-close":function(a){t.allUserShow=!1}}}):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.allProjectShow,callback:function(a){t.allProjectShow=a},expression:"allProjectShow"}},[t.allProjectShow?e("ProjectManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.complaintShow,callback:function(a){t.complaintShow=a},expression:"complaintShow"}},[t.complaintShow?e("ComplaintManagement"):t._e()],1),e("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:t.archivedProjectShow,callback:function(a){t.archivedProjectShow=a},expression:"archivedProjectShow"}},[t.archivedProjectShow?e("ProjectArchived"):t._e()],1),e("transition",{attrs:{name:"mobile-slide"}},[t.showMobileTabbar?e("MobileTabbar",{on:{"on-click":t.onTabbarClick}}):t._e()],1),e("MobileBack",{attrs:{showTabbar:t.showMobileTabbar}}),e("MobileNotification",{ref:"mobileNotification"}),t.$route.name!="manage-apps"?e("MicroApps",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{name:"okr-details",url:t.okrUrl,datas:t.okrWindow}}):t._e(),e("DrawerOverlay",{attrs:{placement:"right",size:600},model:{value:t.approveDetailsShow,callback:function(a){t.approveDetailsShow=a},expression:"approveDetailsShow"}},[t.approveDetailsShow?e("ApproveDetails",{attrs:{data:t.approveDetails},on:{onBack:function(a){t.approveDetailsShow=!1}}}):t._e()],1)],1)},ne=[];const le={components:{SearchBox:oe,ApproveDetails:Y,ImgUpload:G,UserSelect:f,TaskExport:Ht,CheckinExport:j,ApproveExport:V,TaskModal:zt,DialogModal:Nt,MobileNotification:St,MobileBack:wt,MobileTabbar:ht,TaskAdd:vt,Report:P,DrawerOverlay:R,ProjectManagement:ot,TeamManagement:N,ProjectArchived:Z,MicroApps:K,ComplaintManagement:Zt},directives:{longpress:z},data(){return{loadIng:0,mateName:/macintosh|mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl",addShow:!1,addData:{name:"",columns:"",flow:"open"},addRule:{name:[{required:!0,message:this.$L("\u8BF7\u586B\u5199\u9879\u76EE\u540D\u79F0\uFF01"),trigger:"change"},{type:"string",min:2,message:this.$L("\u9879\u76EE\u540D\u79F0\u81F3\u5C112\u4E2A\u5B57\uFF01"),trigger:"change"}]},addTaskShow:!1,createGroupShow:!1,createGroupData:{},createGroupLoad:0,exportTaskShow:!1,exportCheckinShow:!1,exportApproveShow:!1,projectKeyValue:"",projectKeyLoading:0,projectSearchShow:!1,openMenu:{},visibleMenu:!1,showMobileMenu:!1,workReportShow:!1,allUserShow:!1,allProjectShow:!1,archivedProjectShow:!1,natificationReady:!1,notificationManage:null,reportTabs:"my",operateStyles:{},operateVisible:!1,operateItem:{},needStartHome:!1,complaintShow:!1,approveDetails:{id:0},approveDetailsShow:!1}},mounted(){this.notificationInit(),r.on("addTask",this.onAddTask),r.on("createGroup",this.onCreateGroup),r.on("dialogMsgPush",this.addDialogMsg),r.on("approveDetails",this.openApproveDetails),document.addEventListener("keydown",this.shortcutEvent)},activated(){this.$store.dispatch("getUserInfo").catch(t=>{}),this.$store.dispatch("getTaskPriority",1e3),this.$store.dispatch("getReportUnread",1e3),this.$store.dispatch("getApproveUnread",1e3),this.$store.dispatch("needHome").then(t=>{this.needStartHome=!0}).catch(t=>{this.needStartHome=!1})},beforeDestroy(){r.off("addTask",this.onAddTask),r.off("createGroup",this.onCreateGroup),r.off("dialogMsgPush",this.addDialogMsg),r.off("approveDetails",this.openApproveDetails),document.removeEventListener("keydown",this.shortcutEvent)},deactivated(){this.addShow=!1},computed:{...d(["userInfo","userIsAdmin","cacheUserBasic","cacheTasks","cacheDialogs","cacheProjects","projectTotal","wsOpenNum","columnTemplate","clientNewVersion","cacheTaskBrowse","dialogIns","reportUnreadNumber","approveUnreadNumber","okrWindow","formOptions"]),...m(["dashboardTask"]),routeName(){return this.$route.name},okrUrl(){return{}.VITE_OKR_WEB_URL||$A.mainUrl("apps/okr")},msgUnreadMention(){let t=0,s=0;this.cacheDialogs.some(a=>{t+=$A.getDialogUnread(a,!1),s+=$A.getDialogMention(a)}),t>999&&(t="999+"),s>999&&(s="999+");const e=this.msgTodoTotal;return e?s?`@${s}\xB7${e}`:t?`${t}\xB7${e}`:e:t?s?`${t}\xB7@${s}`:String(t):s?`@${s}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(s=>{t+=$A.getDialogNum(s)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((s,e)=>s+(e.todo_num||0),0);return t>0?(t>99?t="99+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},menu(){const{userIsAdmin:t,needStartHome:s}=this,e=[{path:"taskBrowse",name:"\u6700\u8FD1\u6253\u5F00\u7684\u4EFB\u52A1"}];return t?e.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"system",name:"\u7CFB\u7EDF\u8BBE\u7F6E"},{path:"license",name:"License Key"},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"allProject",name:"\u6240\u6709\u9879\u76EE",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"},{path:"team",name:"\u56E2\u961F\u7BA1\u7406",divided:!0},{path:"complaint",name:"\u4E3E\u62A5\u7BA1\u7406"}):e.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"workReport",name:"\u5DE5\u4F5C\u62A5\u544A",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"}),s?e.push({path:"goHome",name:"\u6253\u5F00\u9996\u9875",divided:!0},{path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58"},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}):e.push({path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58",divided:!0},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}),e},columns(){const t=$A.cloneJSON(this.columnTemplate);return t.unshift({name:this.$L("\u7A7A\u767D\u6A21\u677F"),columns:[]}),t},projectLists(){const{projectKeyValue:t,cacheProjects:s}=this,e=$A.cloneJSON(s).sort((a,i)=>a.top_at||i.top_at?$A.sortDay(i.top_at,a.top_at):i.id-a.id);return t?e.filter(a=>$A.strExists(`${a.name} ${a.desc}`,t)):e},taskBrowseLists(){const{cacheTasks:t,cacheTaskBrowse:s,userId:e}=this;return s.filter(({userid:a})=>a===e).map(({id:a})=>t.find(i=>i.id===a)||{})},showMobileTabbar(){return this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?!0:["manage-dashboard","manage-messenger","manage-application"].includes(this.routeName)}},watch:{$route(){this.chackPass()},userInfo(){this.chackPass()},projectKeyValue(t){t!=""&&setTimeout(()=>{this.projectKeyValue==t&&this.searchProject()},600)},wsOpenNum(t){t<=1||this.$store.dispatch("getBasicData",600)},workReportShow(t){!t||this.$store.dispatch("getReportUnread",0)},windowActive(t){!t||this.$store.dispatch("getProjectByQueue",600)},"cacheProjects.length":{handler(){this.$nextTick(t=>{const s=this.$refs.menuProject,e=$A.last($A.getObject(s,"children.0.children"));if(e){const a=e.getBoundingClientRect(),i=s.getBoundingClientRect();if(a.top>i.top+i.height){this.projectSearchShow=!0;return}}this.projectSearchShow=!1})},immediate:!0},unreadAndOverdue:{handler(t){this.$Electron&&this.$Electron.sendMessage("setDockBadge",t)},immediate:!0}},methods:{chackPass(){this.userInfo.changepass===1&&this.goForward({name:"manage-setting-password"})},async toggleRoute(t,s){this.showMobileMenu=!1;let e={name:"manage-"+t,params:s||{}},a=await $A.IDBInt("fileFolderId");t==="file"&&a>0&&(e.params.folderId=a),this.goForward(e)},toggleOpenMenu(t){this.$set(this.openMenu,t,!this.openMenu[t])},settingRoute(t){switch(t){case"allUser":this.allUserShow=!0;return;case"allProject":this.allProjectShow=!0;return;case"archivedProject":this.archivedProjectShow=!0;return;case"exportTask":this.exportTaskShow=!0;return;case"exportOverdueTask":this.exportOverdueTask();return;case"exportCheckin":this.exportCheckinShow=!0;return;case"exportApprove":this.exportApproveShow=!0;return;case"workReport":this.reportUnreadNumber>0&&(this.reportTabs="receive"),this.workReportShow=!0;return;case"version":r.emit("updateNotification",null);return;case"clearCache":$A.IDBSet("clearCache","handle").then(s=>{$A.reloadUrl()});return;case"goHome":this.needStartHome&&this.goForward("index");return;case"approve":this.menu.findIndex(s=>s.path==t)>-1&&this.goForward({name:"manage-approve"});return;case"okrManage":case"okrAnalyze":this.goForward({path:"/manage/apps/"+(t=="okrManage"?"/#/list":"/#/analysis")});return;case"complaint":this.complaintShow=!0;return;case"logout":$A.modalConfirm({title:"\u9000\u51FA\u767B\u5F55",content:"\u4F60\u786E\u5B9A\u8981\u767B\u51FA\u7CFB\u7EDF\uFF1F",onOk:()=>{this.$store.dispatch("logout",!1)}});return}this.menu.findIndex(s=>s.path==t)>-1&&this.toggleRoute("setting-"+t)},exportOverdueTask(){$A.modalConfirm({title:"\u5BFC\u51FA\u4EFB\u52A1",content:"\u4F60\u786E\u5B9A\u8981\u5BFC\u51FA\u6240\u6709\u8D85\u671F\u4EFB\u52A1\u5417\uFF1F",loading:!0,onOk:()=>new Promise((t,s)=>{this.$store.dispatch("call",{url:"project/task/exportoverdue"}).then(({data:e})=>{t(),this.$store.dispatch("downUrl",{url:e.url})}).catch(({msg:e})=>{s(e)})})})},menuVisibleChange(t){this.visibleMenu=t},classNameRoute(t){let s=this.routeName;return(s=="manage-approve"||s=="manage-apps")&&(s="manage-application"),{active:s===`manage-${t}`}},classNameProject(t){return{active:this.routeName==="manage-project"&&this.$route.params.projectId==t.id,"open-menu":this.openMenu[t.id]===!0,operate:t.id==this.operateItem.id&&this.operateVisible}},onAddMenu(t){switch(t){case"project":this.onAddShow();break;case"task":this.onAddTask(0);break;case"group":this.onCreateGroup([this.userId]);break;case"createMeeting":r.emit("addMeeting",{type:"create",userids:[this.userId]});break;case"joinMeeting":r.emit("addMeeting",{type:"join"});break}},onAddShow(){this.$store.dispatch("getColumnTemplate").catch(()=>{}),this.addShow=!0,this.$nextTick(()=>{this.$refs.projectName.focus()})},onAddProject(){this.$refs.addProject.validate(t=>{t&&(this.loadIng++,this.$store.dispatch("call",{url:"project/add",data:this.addData}).then(({data:s,msg:e})=>{$A.messageSuccess(e),this.addShow=!1,this.$refs.addProject.resetFields(),this.$store.dispatch("saveProject",s),this.toggleRoute("project",{projectId:s.id})}).catch(({msg:s})=>{$A.modalError(s)}).finally(s=>{this.loadIng--}))})},searchProject(){setTimeout(()=>{this.projectKeyLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.projectKeyValue}}).finally(t=>{this.projectKeyLoading--})},selectChange(t){this.$nextTick(()=>{this.$set(this.addData,"columns",this.columns[t].columns.join(","))})},shortcutEvent(t){if(t.metaKey||t.ctrlKey)switch(t.keyCode){case 66:t.preventDefault(),this.onAddShow();break;case 70:case 191:t.preventDefault(),this.$refs.searchBox.onShow();break;case 75:case 78:t.preventDefault(),this.onAddMenu("task");break;case 85:this.onCreateGroup([this.userId]);break;case 74:t.preventDefault(),this.onAddMenu("createMeeting");break;case 83:this.$refs.taskModal.checkUpdate()&&t.preventDefault();break;case 188:t.preventDefault(),this.toggleRoute("setting");break}},onAddTask(t){this.addTaskShow=!0,this.$nextTick(s=>{let e={owner:[this.userId]};$A.isJson(t)?e=t:/^[1-9]\d*$/.test(t)&&(e.column_id=t),this.$refs.addTask.setData(e)})},openTask(t){this.$store.dispatch("openTask",t)},onCreateGroup(t){$A.isArray(t)||(t=[]),this.createGroupData={userids:t,uncancelable:[this.userId]},this.createGroupShow=!0},submitCreateGroup(){this.createGroupLoad++,this.$store.dispatch("call",{url:"dialog/group/add",data:this.createGroupData}).then(({data:t,msg:s})=>{$A.messageSuccess(s),this.createGroupShow=!1,this.createGroupData={},this.$store.dispatch("saveDialog",t),this.$store.dispatch("openDialog",t.id),this.toggleRoute("messenger",{dialogAction:"dialog"})}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.createGroupLoad--})},addDialogMsg(t){var v;if(!this.natificationReady&&!this.$isEEUiApp||this.windowActive&&t.dialog_id===((v=$A.last(this.dialogIns))==null?void 0:v.dialog_id))return;const{id:s,dialog_id:e,dialog_type:a,userid:i}=t;if(i==this.userId)return;const o=$A.getMsgSimpleDesc(t);this.__notificationId=s;const h=async l=>{let c=this.cacheUserBasic.find(u=>u.userid==i);if(!c)try{const{data:u}=await this.$store.dispatch("call",{url:"users/basic",data:{userid:[i]},skipAuthError:!0});c=u.find(A=>A.userid==i)}catch{}a==="group"&&c&&(l=`${l} (${c.nickname})`),p(l,c==null?void 0:c.userimg)},p=(l,c)=>{this.__notificationId===s&&(this.__notificationId=null,this.$isEEUiApp?this.$refs.mobileNotification.open({userid:i,title:l,desc:o,callback:()=>{this.goForward({name:"manage-messenger"}),this.$store.dispatch("openDialog",e)}}):this.$Electron?this.$Electron.sendMessage("openNotification",{icon:c||$A.originUrl("images/logo.png"),title:l,body:o,data:t,tag:"dialog",hasReply:!0,replyPlaceholder:this.$L("\u56DE\u590D\u6D88\u606F")}):(this.notificationManage.replaceOptions({icon:c||$A.originUrl("images/logo.png"),body:o,data:t,tag:"dialog"}),this.notificationManage.replaceTitle(l),this.notificationManage.userAgreed()))},g=this.cacheDialogs.find(l=>l.id==e);g?h(g.name):this.$store.dispatch("getDialogOne",e).then(({data:l})=>h(l.name)).catch(()=>{})},openApproveDetails(t){this.approveDetailsShow=!0,this.$nextTick(()=>{this.approveDetails={id:t}})},handleLongpress(t,s){const e=$A.getAttr(s,"data-id"),a=this.projectLists.find(i=>i.id==e);!a||(this.operateVisible=!1,this.operateItem=$A.isJson(a)?a:{},this.$nextTick(()=>{const i=s.getBoundingClientRect();this.operateStyles={left:`${t.clientX}px`,top:`${i.top+this.windowScrollY}px`,height:i.height+"px"},this.operateVisible=!0}))},handleTopClick(){this.$store.dispatch("call",{url:"project/top",data:{project_id:this.operateItem.id}}).then(({data:t})=>{this.$store.dispatch("saveProject",t),this.$nextTick(()=>{const s=this.$refs.menuProject.querySelector(".active");s&&$A.scrollIntoViewIfNeeded(s)})}).catch(({msg:t})=>{$A.modalError(t)})},onTabbarClick(t){switch(t){case"addTask":this.onAddTask(0);break;case"addProject":this.onAddShow();break;case"allUser":case"complaint":case"workReport":this.settingRoute(t);break}},notificationInit(){this.notificationManage=new H(this.$L("\u6253\u5F00\u901A\u77E5\u6210\u529F")),this.notificationManage.support&&(this.notificationManage.notificationEvent({onclick:({target:t})=>{console.log("[Notification] A Click",t),this.notificationManage.close(),this.notificationClick(t),window.focus()}}),this.notificationPermission()),this.$Electron&&(this.$Electron.registerMsgListener("clickNotification",t=>{console.log("[Notification] B Click",t),this.$Electron.sendMessage("mainWindowActive"),this.notificationClick(t)}),this.$Electron.registerMsgListener("replyNotification",t=>{console.log("[Notification] B Reply",t),this.notificationReply(t)}))},notificationPermission(){const t=s=>{switch(s){case"already granted":case"granted":return this.natificationReady=!0;case"close":return this.notificationManage.initNotification(t);case"denied":case"already denied":console.log(s==="denied"?"\u60A8\u521A\u521A\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E":"\u60A8\u66FE\u7EA7\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E");break}};this.notificationManage.initNotification(t)},notificationClick(t){const{tag:s,data:e}=t;if(s=="dialog"){if(!$A.isJson(e))return;this.goForward({name:"manage-messenger"}),this.$nextTick(a=>{this.$store.dispatch("openDialog",e.dialog_id)})}},notificationReply(t){const{tag:s,data:e,reply:a}=t;s=="dialog"&&a&&this.$store.dispatch("call",{url:"dialog/msg/sendtext",data:{dialog_id:e.dialog_id,text:a},method:"post"}).then(({data:i})=>{this.$store.dispatch("saveDialogMsg",i),this.$store.dispatch("increaseTaskMsgNum",i),this.$store.dispatch("increaseMsgReplyNum",i),this.$store.dispatch("updateDialogLastMsg",i)}).catch(({msg:i})=>{$A.modalError(i)})}}},I={};var ce=n(le,re,ne,!1,de,null,null,null);function de(t){for(let s in I)this[s]=I[s]}var $a=function(){return ce.exports}();export{$a as default};
